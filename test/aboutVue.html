<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Vue 相关 | xx的博客</title>
    <meta name="generator" content="VuePress 1.5.0">
    <link rel="icon" href="./2.jpg">
    <meta name="description" content="Welcome">
    <link rel="preload" href="/assets/css/0.styles.8b57ca07.css" as="style"><link rel="preload" href="/assets/js/app.b7abec6d.js" as="script"><link rel="preload" href="/assets/js/2.abe78d93.js" as="script"><link rel="preload" href="/assets/js/20.f61f8be2.js" as="script"><link rel="preload" href="/assets/js/5.f990928a.js" as="script"><link rel="prefetch" href="/assets/js/10.9cf6598d.js"><link rel="prefetch" href="/assets/js/11.df34b82f.js"><link rel="prefetch" href="/assets/js/12.7fb2abf1.js"><link rel="prefetch" href="/assets/js/13.d1e87d6e.js"><link rel="prefetch" href="/assets/js/14.cd14ebb0.js"><link rel="prefetch" href="/assets/js/15.c890b1b1.js"><link rel="prefetch" href="/assets/js/16.8bda8f59.js"><link rel="prefetch" href="/assets/js/17.271cb451.js"><link rel="prefetch" href="/assets/js/18.a8bc42d5.js"><link rel="prefetch" href="/assets/js/19.865cf1bf.js"><link rel="prefetch" href="/assets/js/21.ec8aee77.js"><link rel="prefetch" href="/assets/js/22.d64a6ba2.js"><link rel="prefetch" href="/assets/js/23.2fe942e0.js"><link rel="prefetch" href="/assets/js/24.2cb8cadf.js"><link rel="prefetch" href="/assets/js/25.e14bc8c3.js"><link rel="prefetch" href="/assets/js/26.9216a8e7.js"><link rel="prefetch" href="/assets/js/3.3faae2d7.js"><link rel="prefetch" href="/assets/js/4.be82c51c.js"><link rel="prefetch" href="/assets/js/6.d1da093d.js"><link rel="prefetch" href="/assets/js/7.59fc17b1.js"><link rel="prefetch" href="/assets/js/8.220bb62b.js"><link rel="prefetch" href="/assets/js/9.28a30f0e.js">
    <link rel="stylesheet" href="/assets/css/0.styles.8b57ca07.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">xx的博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  最近阅读
</a></div><div class="nav-item"><a href="/test/" class="nav-link router-link-active">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="联系方式" class="dropdown-title"><span class="title">联系方式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ins/" class="nav-link">
  Ins
</a></li><li class="dropdown-item"><!----> <a href="/wechat/" class="nav-link">
  微信
</a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/xuxin2019f" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gittee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/xuxin2019-f" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/reading/" class="nav-link">
  最近阅读
</a></div><div class="nav-item"><a href="/test/" class="nav-link router-link-active">
  面试题
</a></div><div class="nav-item"><a href="/about/" class="nav-link">
  关于我
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="联系方式" class="dropdown-title"><span class="title">联系方式</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/ins/" class="nav-link">
  Ins
</a></li><li class="dropdown-item"><!----> <a href="/wechat/" class="nav-link">
  微信
</a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/xuxin2019f" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gittee
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/xuxin2019-f" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/test/" aria-current="page" class="sidebar-link">CSS 相关</a></li><li><a href="/test/aboutHtml.html" class="sidebar-link">HTML 相关</a></li><li><a href="/test/aboutjs.html" class="sidebar-link">js 相关</a></li><li><a href="/test/web.html" class="sidebar-link">浏览器</a></li><li><a href="/test/webpack.html" class="sidebar-link">webpack</a></li><li><a href="/test/safety.html" class="sidebar-link">网络安全</a></li><li><a href="/test/aboutVue.html" aria-current="page" class="active sidebar-link">Vue 相关</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_1-vue-常用指令" class="sidebar-link">1.vue 常用指令</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_2-vue-常见修饰符" class="sidebar-link">2.vue 常见修饰符</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_3-计算属性-computed-与侦听属性-watch-的区别" class="sidebar-link">3.计算属性 computed 与侦听属性 watch 的区别</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_4-vue-中如何进行深度监听" class="sidebar-link">4.Vue 中如何进行深度监听</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_5-vue-router-有哪几种导航守卫" class="sidebar-link">5.vue-router 有哪几种导航守卫?</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_5-怎么理解-mvvm？它和-mvc-有什么异同？（两个问题，逐一回答）" class="sidebar-link">5.怎么理解 MVVM？它和 MVC 有什么异同？（两个问题，逐一回答）</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_6-vue-的双向数据绑定原理是什么" class="sidebar-link">6.Vue 的双向数据绑定原理是什么</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_7-vue2-响应式原理" class="sidebar-link">7.vue2 响应式原理</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_9-vue3-0-响应式原理" class="sidebar-link">9.vue3.0 响应式原理</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_10-vue3-0-新特性" class="sidebar-link">10.vue3.0 新特性</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_11-vue-中操作-dom" class="sidebar-link">11.vue 中操作 dom</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_12-详细说明-vue-的生命周期（不仅限于把钩子函数写出来）" class="sidebar-link">12.详细说明 Vue 的生命周期（不仅限于把钩子函数写出来）</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_13-父子组件的生命周期顺序是怎么样的？" class="sidebar-link">13.父子组件的生命周期顺序是怎么样的？</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_14-vue-router-的原理" class="sidebar-link">14.vue-router 的原理</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_15-vue中h、-c、-v、-s的含义" class="sidebar-link">15.vue中h、c、v、_s的含义</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_16-vue-和-react-的编译区别" class="sidebar-link">16.vue 和 react 的编译区别</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_17-vue-组件之前传值" class="sidebar-link">17.vue 组件之前传值</a></li><li class="sidebar-sub-header"><a href="/test/aboutVue.html#_18-实现一个-vuex" class="sidebar-link">18.实现一个 vuex</a></li></ul></li><li><a href="/test/aboutReact.html" class="sidebar-link">React 相关</a></li><li><a href="/test/math.html" class="sidebar-link">算法相关</a></li><li><a href="/test/git.html" class="sidebar-link">git 相关</a></li><li><a href="/test/aboutTs.html" class="sidebar-link">关于 TS</a></li><li><a href="/test/test.html" class="sidebar-link">总结的面试题</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="vue-相关"><a href="#vue-相关" class="header-anchor">#</a> Vue 相关</h1> <h2 id="_1-vue-常用指令"><a href="#_1-vue-常用指令" class="header-anchor">#</a> 1.vue 常用指令</h2> <ul><li>v-model:双向绑定语法糖</li> <li>v-html: 将 html 片段填充到标签内(有安全隐患)</li> <li>v-text: 将数据填充到标签(包括 html 标签，注意此处是单向绑定)</li> <li>v-once: 数据只绑定一次，数据再次改变时，视图不会再改变了</li> <li>v-if/v-else-if:条件渲染</li> <li>v-for: 循环渲染(注意 key，并且 key 要唯一，不要用 index 做 key 值，不利于 diff)</li> <li>v-show: 通过控制 dom 的 display 来控制 dom 的隐藏和显示(注意与 v-if 的不同，v-if 是根据条件来删除或添加元素；初次渲染时，不论条件是否为 true，v-show 的元素都会渲染，而 v-if 只有在 true 时才会渲染，可以根据这点做性能优化)</li> <li>v-on: 事件绑定，简写为@</li> <li>v-bind: 属性绑定,简写为:</li></ul> <h2 id="_2-vue-常见修饰符"><a href="#_2-vue-常见修饰符" class="header-anchor">#</a> 2.vue 常见修饰符</h2> <ul><li>.stop: 阻止事件冒泡</li> <li>.capture: 阻止事件捕获</li> <li>.self: 控制事件对象是操作本身的时候才起作用</li> <li>.prevent: 阻止默认事件</li> <li>.once: 控制元素指定事件只触发一次</li> <li>.passive:立即触发(注意 passive 和 prevent 不要一起用，prevent 会失效)
表单特有的修饰符：</li> <li>.number: 将输入内容转换成数值类型</li> <li>.lazy: 将 input 转变为 change 事件</li> <li>.trim: 删除左右两边空格
按键修饰符：</li> <li>@keyup.enter/space/tab/up/left/down/right(可以连用)</li> <li>@keyup.13</li> <li>自定义：Vue.config.keyCodes.f5 = 116 -&gt; @keyup.f5='handle'</li></ul> <h2 id="_3-计算属性-computed-与侦听属性-watch-的区别"><a href="#_3-计算属性-computed-与侦听属性-watch-的区别" class="header-anchor">#</a> 3.计算属性 computed 与侦听属性 watch 的区别</h2> <p>计算属性支持缓存，只有依赖数据发生改变才会重新进行计算。计算属性不支持异步，当内部有异步操作时无法更新。计算属性可以计算 vuex 中的内容（即不一定是 data 或父组件传递来的 props 属性值）</p> <p>watch 不支持缓存，数据变直接出发相应操作。watch 支持异步。watch 监听的数据必须是 data 中声明过或父组件传递过来的。watch 中监听的函数接收两个参数：最新的值和更新前的旧值。watch 也有两个参数：immediate 和 deep。</p> <p>​ immediate：组件加载立即触发回调函数执行，</p> <p>deep: 深度监听，为了发现<strong>对象内部值</strong>的变化，复杂类型的数据时使用，例如数组中的对象内容的改变，注意监听数组的变动不需要这么做。注意：deep 无法监听到数组的变动和对象的新增，参考 vue 数组变异,只有以响应式的方式触发才会被监听到。</p> <h2 id="_4-vue-中如何进行深度监听"><a href="#_4-vue-中如何进行深度监听" class="header-anchor">#</a> 4.Vue 中如何进行深度监听</h2> <p>在 watch 中设置 deep:true 这个属性可以进行深度监听</p> <h2 id="_5-vue-router-有哪几种导航守卫"><a href="#_5-vue-router-有哪几种导航守卫" class="header-anchor">#</a> 5.vue-router 有哪几种导航守卫?</h2> <ol><li>全局路由守卫： router.beforeEach((to,from,next)=&gt;{...})
全局后置守卫： router.afterEach((to,from)=&gt;{})
<strong>应用场景：配合路由守卫(比如自定义的 permission.js),进入页面登录判断、管理员权限判断、浏览器判断</strong></li> <li>局部守卫： 组件内的守卫：<strong>beforeRouteEnter、beforeRouteUpdate、beforeRouteLeave</strong></li></ol> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token keyword">const</span> Foo <span class="token operator">=</span> <span class="token punctuation">{</span>
  template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">...</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteEnter</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在渲染该组件的对应路由被 confirm 前调用</span>
    <span class="token comment">// 不！能！获取组件实例 `this`</span>
    <span class="token comment">// 因为当钩子执行前，组件实例还没被创建</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteUpdate</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 在当前路由改变，但是该组件被复用时调用</span>
    <span class="token comment">// 举例来说，对于一个带有动态参数的路径 /foo/:id，在 /foo/1 和 /foo/2 之间跳转的时候，</span>
    <span class="token comment">// 由于会渲染同样的 Foo 组件，因此组件实例会被复用。而这个钩子就会在这个情况下被调用。</span>
    <span class="token comment">// 可以访问组件实例 `this`</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function">beforeRouteLeave</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 导航离开该组件的对应路由时调用</span>
    <span class="token comment">// 可以访问组件实例 `this`</span>

  <span class="token punctuation">}</span>
</code></pre></div><p>应用：</p> <ul><li>切换路由时清除定时器</li> <li>当页面有未关闭的窗口或为保存的内容时阻止页面跳转(next(false))</li></ul> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">beforeRouteLeave</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token comment">//判断是否弹出框的状态和保存信息与否</span>
 <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisibility <span class="token operator">===</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>dialogVisibility <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">//关闭弹出框</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">//回到当前页面, 阻止页面跳转</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>saveMessage <span class="token operator">===</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">'请保存信息后退出!'</span><span class="token punctuation">)</span> <span class="token comment">//弹出警告</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token comment">//回到当前页面, 阻止页面跳转</span>
  <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">//否则允许跳转</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>在页面关闭前将公共信息保存到 session 或 vue 中</li></ul> <div class="language-js extra-class"><pre class="language-js"><code> <span class="token function">beforeRouteLeave</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    localStorage<span class="token punctuation">.</span><span class="token function">setItem</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//保存到localStorage中</span>
    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ol start="3"><li>路由独享守卫
在路由配置时直接定义：</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">VueRouter</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  routes<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      path<span class="token operator">:</span> <span class="token string">'/foo'</span><span class="token punctuation">,</span>
      component<span class="token operator">:</span> Foo<span class="token punctuation">,</span>
      <span class="token function-variable function">beforeEnter</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token parameter">to<span class="token punctuation">,</span> <span class="token keyword">from</span><span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
</code></pre></div><h2 id="_5-怎么理解-mvvm？它和-mvc-有什么异同？（两个问题，逐一回答）"><a href="#_5-怎么理解-mvvm？它和-mvc-有什么异同？（两个问题，逐一回答）" class="header-anchor">#</a> 5.怎么理解 MVVM？它和 MVC 有什么异同？（两个问题，逐一回答）</h2> <p>首先 M 表示数据模型,V 表示视图,而 vm 表示他们之间连接的一道桥梁,负责监听 model 中的数据来控制视图的更新；监听页面的变化来更新 model 中的数据，实现<strong>双向数据绑定</strong>。在 mvvm 中，view 和 model 之间没有直接的关系，而是通过 vm 进行交互。
<img src="https://img-blog.csdnimg.cn/20191014160240656.jpg?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIwNTkzNw==,size_16,color_FFFFFF,t_70" alt="å¨è¿éæå¥å¾çæè¿°"></p> <p>mvc 模型指 model-view-controller， view 和 model 是通过 controller 来承上启下</p> <p><img src="https://img-blog.csdnimg.cn/20191014163933330.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTIwNTkzNw==,size_16,color_FFFFFF,t_70" alt="å¨è¿éæå¥å¾çæè¿°"></p> <p><strong>vue2 中的 mvvm 模型是在底层 Object.defineProperty 中实现的</strong></p> <p><strong>vue3 中的 mvvm 模型是通过 proxy 实现的</strong></p> <h2 id="_6-vue-的双向数据绑定原理是什么"><a href="#_6-vue-的双向数据绑定原理是什么" class="header-anchor">#</a> 6.Vue 的双向数据绑定原理是什么</h2> <p>vue 响应式原理(发布订阅模式：观察者的实现 vue2.0 是通过 Object.defineProperty,vue3.0 是通过 es6 的 Proxy)+v-model(:value='msg'+@input='msg=$event.target.value')</p> <h2 id="_7-vue2-响应式原理"><a href="#_7-vue2-响应式原理" class="header-anchor">#</a> 7.vue2 响应式原理</h2> <p>vue2 响应原理的核心：<strong>Object.defineProperty 实现数据拦截</strong></p> <p>vue 的响应式系统依赖三个重要的类：<strong>Observer 类（观察者），Dep 类（发布者），Wathcer 类（订阅者）</strong></p> <ul><li>Observer 类中，实现数据拦截，遍历 data 中的每个属性，并转换为 getter 和 setter，并<strong>为每个属性都实例化一个 Dep 发布者</strong>。<strong>在初始化时</strong>，调用属性的<strong>getter 方法</strong>，这个方法通知 Dep 将其将之声明为依赖，<strong>并触发 Dep 的 addDep 将每个 watcher 压入 Dep 的数组中</strong>；<strong>当修改属性</strong>时，调用<strong>setter 函数</strong>，<strong>这个函数会触发 Dep 的 notify 方法，这个方法实现遍历 Dep 中数组的每个 watcher，触发每个 watcher 的更新函数 update，实现视图的更新</strong></li> <li>Dep 类中，声明一个数组来存放若干 watcher，还有两个重要的方法：addDep 实现将某个 watcher 压入数组中；notify 实现遍历数组中的每个 watcher 实现更新操作。<strong>Dep 与 data 中的每个属性一一对应。</strong></li> <li>Watcher 类，与视图中的每个使用到 data 属性的依赖一一对应。其中 update 函数实现更新操作。</li></ul> <p><strong><em>注意：以上操作是实现了视图随着数据变化，那么如何让数据也随着视图的变化而变化呢？（即如何实现数据的双向绑定）</em></strong></p> <p>即 vue 的响应式原理实现的是</p> <div class="language-js extra-class"><pre class="language-js"><code>  v<span class="token operator">-</span>bind<span class="token operator">:</span>value<span class="token operator">=</span><span class="token string">'msg'</span>
  msg变化时，value也变化了
</code></pre></div><p>要实现 value 变化时，msg 也跟着变化：</p> <p><strong>监听 input 事件：</strong></p> <div class="language-js extra-class"><pre class="language-js"><code>v<span class="token operator">-</span>on<span class="token operator">:</span>input<span class="token operator">=</span><span class="token string">'msg=$event.target.value'</span>
</code></pre></div><h2 id="_9-vue3-0-响应式原理"><a href="#_9-vue3-0-响应式原理" class="header-anchor">#</a> 9.vue3.0 响应式原理</h2> <p>与 2.0 大致原理类似，只是用 proxy 来实现观察者。
vue2.0 中实现一个观察者(简易版)：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">Observer</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> key <span class="token keyword">of</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'object'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> key<span class="token punctuation">,</span> <span class="token punctuation">{</span>
        enumerable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        configurable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
        <span class="token keyword">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'获取值：'</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>
          <span class="token keyword">return</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token keyword">set</span><span class="token punctuation">(</span>newValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'设置值：'</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>newValue <span class="token operator">===</span> data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span>
          <span class="token punctuation">}</span>
          data<span class="token punctuation">[</span>key<span class="token punctuation">]</span> <span class="token operator">=</span> newValue
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">'18'</span><span class="token punctuation">,</span>
  a<span class="token operator">:</span> <span class="token punctuation">{</span>
    b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    c<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Observer</span><span class="token punctuation">(</span>obj<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
app<span class="token punctuation">.</span>newPropKey <span class="token operator">=</span> <span class="token string">'新属性'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>newPropKey<span class="token punctuation">)</span>

<span class="token comment">// 执行结果:</span>
<span class="token comment">// 修改 obj原有的属性 age的输出</span>
<span class="token comment">//设置值age</span>
<span class="token comment">//获取值age</span>
<span class="token comment">//20</span>
<span class="token comment">// 新属性</span>
</code></pre></div><p>这样做的问题：</p> <ul><li>监测不到对象属性的添加和删除：当在对象上新加一个属性时，这个新加的属性并没有加入 vue 监测数据更新的机制（因为是在最初始化时添加的）</li> <li>监测不到数组下标的变化，导致直接通过数组下标给数组设置值时不能实时响应</li></ul> <p><strong>以上两点可以通过 vue.$set解决，$set 内部也是通过重新调用 Object.defineProperty 来处理的</strong></p> <ul><li>当 data 中数据比较多且层级很深的时候，会有性能问题，因为要遍历 data 中所有的数据并给其设置成响应式的。
vue3 中通过 Proxy 处理：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
  age<span class="token operator">:</span> <span class="token string">'18'</span><span class="token punctuation">,</span>
  a<span class="token operator">:</span> <span class="token punctuation">{</span>
    b<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
    c<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Proxy</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> <span class="token punctuation">{</span>
  <span class="token keyword">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'访问了：'</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>
    <span class="token keyword">return</span> Reflect<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token keyword">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'设置了：'</span> <span class="token operator">+</span> key<span class="token punctuation">)</span>
    Reflect<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> key<span class="token punctuation">,</span> value<span class="token punctuation">,</span> receiver<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
p<span class="token punctuation">.</span>age <span class="token operator">=</span> <span class="token number">20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>age<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>newValue <span class="token operator">=</span> <span class="token string">'新属性'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>newValue<span class="token punctuation">)</span>
p<span class="token punctuation">.</span>a<span class="token punctuation">.</span>d <span class="token operator">=</span> <span class="token string">'obj中a属性的新值'</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>p<span class="token punctuation">.</span>a<span class="token punctuation">.</span>d<span class="token punctuation">)</span>
<span class="token comment">// 结果:设置新值时也会走Proxy拦截</span>
</code></pre></div><p>可以看到，新增的属性，并不需要重新添加响应式处理，因为 <code>Proxy</code> 是对对象的操作，只要你访问对象，就会走到 <code>Proxy</code> 的逻辑中。</p> <blockquote><p>Reflect(ES6 引入) 是一个内置的对象，它提供拦截 JavaScript 操作的方法。将 Object 对象一些明显属于语言内部方法（比如<code>Object.defineProperty()</code>）放到<code>Reflect</code>对象上。修改某些 Object 方法的返回结果，让其变得更合理。让 Object 操作都变成函数行为。具体内容查看[MDN]</p></blockquote> <h2 id="_10-vue3-0-新特性"><a href="#_10-vue3-0-新特性" class="header-anchor">#</a> 10.vue3.0 新特性</h2> <h3 id="基于-proxy-的观察者"><a href="#基于-proxy-的观察者" class="header-anchor">#</a> 基于 Proxy 的观察者</h3> <p>proxy 是 es6 引入的原生构造函数，<strong>是在对象之前设置的一个拦截，是对对象的设置，任何对对象的设置（新增、访问、删除）都会先进 proxy 拦截</strong>。而 Object.defineProperty 是对对象中的属性的劫持，当修改对象或者通过修改数组下标来修改时，无法再次触发 Object.defineProperty 中的 set 和 get</p> <p>注意关于观察者 vue3.0 与 vue2.0 的对比：</p> <ul><li>​ <strong>默认进行懒观察（lazy observation）</strong>。在 2.x 版本里，不过数据多大，都会在一开始就为其创建观察者。当数据很大时，这可能会在页面载入时造成明显的性能压力。3.x 版本，只会对「被用于渲染初始可见部分的数据」创建观察者，而且 3.x 的观察者更高效。</li> <li>​ <strong>更精准的变更通知</strong>。比例来说：2.x 版本中，你使用 Vue.set 来给对象新增一个属性时，这个对象的所有 watcher 都会重新运行；3.x 版本中，只有依赖那个属性的 watcher 才会重新运行。</li></ul> <h3 id="performance-更好的性能"><a href="#performance-更好的性能" class="header-anchor">#</a> Performance 更好的性能</h3> <ul><li>重写了虚拟 dom</li> <li>编译模板的优化
<strong>主要的优化有：静态节点不标记（不 diff）、动态节点根据不同的类型标记不同的数字、事件缓存、静态提升</strong></li></ul> <p><strong>1.静态标记</strong></p> <p>以下代码：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>app<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>技术摸鱼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>今天天气真不错<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>在 vue2 中会被解析成：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">with</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">_c</span><span class="token punctuation">(</span>
      <span class="token string">'div'</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        attrs<span class="token operator">:</span> <span class="token punctuation">{</span>
          id<span class="token operator">:</span> <span class="token string">'app'</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">[</span>
        <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">'技术摸鱼'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">'今天天气真不错'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>其中前面两个标签是完全静态的，后续的渲染中不会产生任何变化，<code>Vue2</code>中依然使用<code>_c</code>新建成<code>vdom</code>，在<code>diff</code>的时候需要对比，有一些额外的性能损耗</p> <p>而在 vue3 中，在创建虚拟 dom 时会引入第四个数字参数，<strong>只有 number ＞ 0 时才会被标记追踪，进行 diff 操作</strong>，静态节点不引入第四个参数（或为-1，静态提升？）,即静态节点不被遍历追踪</p> <p>vue3 版：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  createVNode <span class="token keyword">as</span> _createVNode<span class="token punctuation">,</span>
  toDisplayString <span class="token keyword">as</span> _toDisplayString<span class="token punctuation">,</span>
  openBlock <span class="token keyword">as</span> _openBlock<span class="token punctuation">,</span>
  createBlock <span class="token keyword">as</span> _createBlock<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'技术摸鱼'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'今天天气真不错'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// Check the console for the AST</span>
</code></pre></div><p>不同数字代表不同的标记，如 1 代表动态 text、2 代表动态 class、8 代表动态 props 属性，当一个标签内有多个动态数据时，采用位运算组合的形式，看下一个例子：</p> <div class="language-html extra-class"><pre class="language-html"><code>div id=&quot;app&quot;&gt;
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>技术摸鱼<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>今天天气真不错<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">:id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>userid<span class="token punctuation">&quot;</span></span><span class="token attr-name">&quot;</span><span class="token punctuation">&gt;</span></span>{{name}}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>转变为：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  createVNode <span class="token keyword">as</span> _createVNode<span class="token punctuation">,</span>
  toDisplayString <span class="token keyword">as</span> _toDisplayString<span class="token punctuation">,</span>
  openBlock <span class="token keyword">as</span> _openBlock<span class="token punctuation">,</span>
  createBlock <span class="token keyword">as</span> _createBlock<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">'app'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'技术摸鱼'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">'今天天气真不错'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span>
        <span class="token string">'div'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          id<span class="token operator">:</span> _ctx<span class="token punctuation">.</span>userid<span class="token punctuation">,</span>
          <span class="token string">'&quot;'</span><span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">9</span> <span class="token comment">/* TEXT, PROPS */</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>text</code>是 1，<code>props</code>是 8，组合在一起就是 9，我们可以简单的通过位运算来判定需要做<code>text</code>和<code>props</code>的判断, 按位与即可，只要不是 0 就是需要比较</p> <p><img src="https://user-gold-cdn.xitu.io/2020/4/22/1719fe3165b2b2be?imageView2/0/w/1280/h/960/ignore-error/1" alt="img"></p> <p><strong>2.事件监听缓存：catchHandlers</strong></p> <p>假设我们要绑定一个事件：</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>onClick<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    {{msg}}
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>关闭<code>cacheHandlers</code>后：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  toDisplayString <span class="token keyword">as</span> _toDisplayString<span class="token punctuation">,</span>
  createVNode <span class="token keyword">as</span> _createVNode<span class="token punctuation">,</span>
  openBlock <span class="token keyword">as</span> _openBlock<span class="token punctuation">,</span>
  createBlock <span class="token keyword">as</span> _createBlock<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span>
        <span class="token string">'span'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          onClick<span class="token operator">:</span> _ctx<span class="token punctuation">.</span>onClick<span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">9</span> <span class="token comment">/* TEXT, PROPS */</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token string">'onClick'</span><span class="token punctuation">]</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
复制代码
</code></pre></div><p><code>onClick</code>会被视为<code>PROPS</code>动态绑定，<strong>后续替换点击事件时需要进行更新。</strong></p> <p>开启<code>cacheHandlers</code>后：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token punctuation">{</span>
  toDisplayString <span class="token keyword">as</span> _toDisplayString<span class="token punctuation">,</span>
  createVNode <span class="token keyword">as</span> _createVNode<span class="token punctuation">,</span>
  openBlock <span class="token keyword">as</span> _openBlock<span class="token punctuation">,</span>
  createBlock <span class="token keyword">as</span> _createBlock<span class="token punctuation">,</span>
<span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>
    <span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
      <span class="token function">_createVNode</span><span class="token punctuation">(</span>
        <span class="token string">'span'</span><span class="token punctuation">,</span>
        <span class="token punctuation">{</span>
          onClick<span class="token operator">:</span> _cache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token punctuation">(</span>_cache<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">$event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> _ctx<span class="token punctuation">.</span><span class="token function">onClick</span><span class="token punctuation">(</span>$event<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>msg<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token number">1</span> <span class="token comment">/* TEXT */</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p><code>cache[1]</code>，<strong>会自动生成并缓存一个内联函数</strong>，“神奇”的变为一个<strong>静态节点</strong>。 Ps：<strong>相当于<code>React</code>中<code>useCallback</code>自动化。</strong></p> <p>并且支持手写内联函数：</p> <div class="language- extra-class"><pre class="language-text"><code>&lt;div&gt;
  &lt;span @click=&quot;()=&gt;foo()&quot;&gt;
    {{msg}}
  &lt;/span&gt;
&lt;/div&gt;
</code></pre></div><p><strong>3.静态提示</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&lt;</span>div id<span class="token operator">=</span><span class="token string">&quot;app&quot;</span><span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>h1<span class="token operator">&gt;</span>技术摸鱼<span class="token operator">&lt;</span><span class="token operator">/</span>h1<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>p<span class="token operator">&gt;</span>今天天气真不错<span class="token operator">&lt;</span><span class="token operator">/</span>p<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div<span class="token operator">&gt;</span><span class="token punctuation">{</span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
    <span class="token operator">&lt;</span>div <span class="token operator">:</span><span class="token keyword">class</span><span class="token operator">=</span><span class="token string">&quot;{red:isRed}&quot;</span><span class="token operator">&gt;</span>摸鱼符<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span><span class="token operator">/</span>div<span class="token operator">&gt;</span>

<span class="token operator">=&gt;</span>

<span class="token keyword">const</span> _hoisted_1 <span class="token operator">=</span> <span class="token punctuation">{</span> id<span class="token operator">:</span> <span class="token string">&quot;app&quot;</span> <span class="token punctuation">}</span>
<span class="token keyword">const</span> _hoisted_2 <span class="token operator">=</span> <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;h1&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;技术摸鱼&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED */</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> _hoisted_3 <span class="token operator">=</span> <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;p&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token string">&quot;今天天气真不错&quot;</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span> <span class="token comment">/* HOISTED */</span><span class="token punctuation">)</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">_ctx<span class="token punctuation">,</span> _cache</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token function">_openBlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">_createBlock</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> _hoisted_1<span class="token punctuation">,</span> <span class="token punctuation">[</span>
    _hoisted_2<span class="token punctuation">,</span>
    _hoisted_3<span class="token punctuation">,</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token function">_toDisplayString</span><span class="token punctuation">(</span>_ctx<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* TEXT */</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token function">_createVNode</span><span class="token punctuation">(</span><span class="token string">&quot;div&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
      <span class="token keyword">class</span><span class="token operator">:</span> <span class="token punctuation">{</span>red<span class="token operator">:</span>_ctx<span class="token punctuation">.</span>isRed<span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;摸鱼符&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span> <span class="token comment">/* CLASS */</span><span class="token punctuation">)</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="tree-shaking-摇树功能"><a href="#tree-shaking-摇树功能" class="header-anchor">#</a> Tree shaking 摇树功能</h3> <p>仅打包需要的代码，无用模块剪辑</p> <h3 id="composition-api-组合式-api-重要"><a href="#composition-api-组合式-api-重要" class="header-anchor">#</a> Composition API 组合式 API(重要)</h3> <p><a href="https://composition-api.vuejs.org/zh/#%E6%A6%82%E8%BF%B0" target="_blank" rel="noopener noreferrer">官方文档<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
见我 github 中 vue3 的练习：https://github.com/xuxin2019-f/vue3-practice</p> <h3 id="更好的-typescript-支持"><a href="#更好的-typescript-支持" class="header-anchor">#</a> 更好的 TypeScript 支持</h3> <p>vue3 是用 ts 编写的库，支持 tsx，class 组件还会继续支持，但需要引入 vue-class-component@next</p> <h2 id="_11-vue-中操作-dom"><a href="#_11-vue-中操作-dom" class="header-anchor">#</a> 11.vue 中操作 dom</h2> <p><strong>vue2 中：</strong></p> <ul><li>在 mounted 生命周期中，dom 已经渲染完毕，可以获取 dom 元素</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>elementList <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span>selectors<span class="token punctuation">)</span> <span class="token comment">//获取多个dom元素 如ul中的li</span>
</code></pre></div><ul><li>通过给元素添加 ref 属性后，通过 this.$refs 获取：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">;</span><span class="token operator">&lt;</span>button ref<span class="token operator">=</span><span class="token string">&quot;btn&quot;</span><span class="token operator">&gt;</span>获取ref<span class="token operator">&lt;</span><span class="token operator">/</span>button<span class="token operator">&gt;</span>
<span class="token keyword">this</span><span class="token punctuation">.</span>$refs<span class="token punctuation">.</span>btn<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">'#ff0000'</span>
</code></pre></div><p><strong>vue3 中：</strong></p> <p>在 watchEffect 和 function 中可以直接操作 dom 元素</p> <h2 id="_12-详细说明-vue-的生命周期（不仅限于把钩子函数写出来）"><a href="#_12-详细说明-vue-的生命周期（不仅限于把钩子函数写出来）" class="header-anchor">#</a> 12.详细说明 Vue 的生命周期（不仅限于把钩子函数写出来）</h2> <p>从无到有,在到无的一个过程</p> <p>一共分为 4 个阶段 创建 加载 更新 销毁</p> <ul><li>beforeCreate
在实例初始化之后，数据观测和事件配置之前被调用 此时 data 和 methods 以及页面的 DOM 结构都没有初始化 什么都做不了</li> <li>created
在实例创建完成后被立即调用此时 data 和 methods 已经可以使用 但是 html 页面还没有渲染出来</li> <li>beforeMount
在挂载开始之前被调用 此时页面上还看不到真实数据 只是一个模板页面而已</li> <li>mounted
el 的 dom 被新创建的 vm.$el 的 dom 替换，并挂载到实例上去之后调用该钩子。 数据已经真实渲染到页面上 在这个钩子函数里面我们可以使用一些第三方的插件</li> <li>beforeUpdate
数据更新时调用，发生在虚拟 DOM 打补丁之前。 页面上数据还是旧的</li> <li>updated
由于数据更改导致的虚拟 DOM 重新渲染和打补丁，在这之后会调用该钩子。 页面上数据已经替换成最新的</li> <li>beforeDestroy
实例销毁之前调用</li> <li>destroyed
实例销毁后调用 1.在 created 的时候，视图中的 html 并没有渲染出来，所以此时如果直接去操作 html 的 dom 节点，一定找不到相关的元素，但是已经可以调用 methods 中的方法了 2.在 mounted 中，由于此时 html 已经渲染出来了，所以可以直接操作 dom 节点。但 mounted 不会承诺所有的子组件也都一起被挂载。如果希望等到整个视图都渲染完毕，那就需要使用到 vm.$nextTick
总得来说，如果不涉及 dom 的直接操作，获取后端的数据既可以放在 created 里，也可以放在 mounted 里。如果涉及 dom 操作，则放在 mounted 里，否则会报错
如果涉及到请求数据的异步方法，最好的解决方案就是在 methods 里定义，然后在 created 和 mounted 里通过 this.方法来调用。</li></ul> <h2 id="_13-父子组件的生命周期顺序是怎么样的？"><a href="#_13-父子组件的生命周期顺序是怎么样的？" class="header-anchor">#</a> 13.父子组件的生命周期顺序是怎么样的？</h2> <ol><li>加载渲染的过程</li> <li>子组件更新的过程</li> <li>父组件更新的过程</li> <li>销毁的过程</li></ol> <h2 id="_14-vue-router-的原理"><a href="#_14-vue-router-的原理" class="header-anchor">#</a> 14.vue-router 的原理</h2> <h3 id="前端路由"><a href="#前端路由" class="header-anchor">#</a> 前端路由</h3> <p>前端路由的两种实现模式：hash 模式和 history 模式</p> <h4 id="hash-模式"><a href="#hash-模式" class="header-anchor">#</a> hash 模式</h4> <p>hash 方法是在路由中带有一个#，主要原理是通过监听#后的 url 标识的更改触发<strong>hashchange</strong>事件，然后通过<strong>location.hash</strong>得到当前变化了的标识符，再进行路由跳转。由于变化的只是#后的值，并不会导致浏览器向服务器发送请求，不会刷新页面，也不需要服务器的支持。</p> <p><img src="https://segmentfault.com/img/remote/1460000013243919?w=1043&amp;h=1199" alt="hash-mode"></p> <p>这里的基础知识有：</p> <ul><li>location.pathname: 返回 url 路径名</li> <li>location.href: 返回完整的 url</li> <li>location.hash:返回 url 的锚部分</li> <li>hashchange 事件：当 location.hash 发生改变时触发</li></ul> <h4 id="history-模式"><a href="#history-模式" class="header-anchor">#</a> history 模式</h4> <p>html5 中的 history 可以通过 pushState 和 replaceState 修改 url：</p> <div class="language- extra-class"><pre><code>history.go(n)：路由跳转，比如n为 2 是往前移动2个页面，n为 -2 是向后移动2个页面，n为0是刷新页面
</code></pre></div><p>history.back()：路由后退，相当于 history.go(-1)
history.forward()：路由前进，相当于 history.go(1)
<strong>history.pushState()：添加一条路由历史记录，如果设置跨域网址则报错</strong> <strong>history.replaceState()：替换当前页在路由历史记录的信息</strong> <strong>popstate 事件：当活动的历史记录发生变化，就会触发 popstate 事件，在点击浏览器的前进后退按钮或者调用上面前三个方法的时候也会触发，参见 MDN</strong></p> <p><img src="https://segmentfault.com/img/remote/1460000013243920" alt="html5-mode"></p> <p>与 hash 不同的是，hash 中 a 标签的 href 地址只要是'#/xxx'即可跳转锚点，而 history 中 a 标签的 href 跳转不到响应的'/xxx'，所以要做响应的处理。</p> <p><strong>history.pushState()和 history.replaceState()，用来在浏览历史中添加和修改记录。<strong>state 属性用来保存记录对象，而</strong>popstate 事件用来监听 history 对象的变化。他们最大的特点是添加或替换历史记录后，浏览器地址栏会变成你传的地址，而页面并不会重新载入或跳转。</strong> <strong>history 造成的问题！由于 history 模式会直接改变 url，所以在刷新或直接访问路由地址的时候会向服务端发送请求，发生匹配不到静态资源的情况，这需要服务器也作相应的配置，比如匹配不到的都去 index.html 页等，否则会出现 404（如以下案例在刷新后直接 404）</strong></p> <h3 id="vue-中路由的实现"><a href="#vue-中路由的实现" class="header-anchor">#</a> vue 中路由的实现</h3> <ol><li>Vue.use(VueRouter)其实调用的是 VueRouter 类的 install 方法</li> <li>类的初始化里要调用 window 监听方法的函数、映射路由的一个函数、初始化 router-view 和 router-link 组件的函数</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">VueRouter</span> <span class="token punctuation">{</span>
 <span class="token comment">// 这里的options是以后接收的配置项：</span>
 <span class="token comment">// {</span>
 <span class="token comment">//   routes: [{ path: &quot;/&quot;, component: Home }, { path: &quot;/about&quot;, component: About }]</span>
 <span class="token comment">// }</span>
 <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>$options <span class="token operator">=</span> options<span class="token punctuation">;</span>
   <span class="token comment">// 初始化路由配置</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>routeMap <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

   <span class="token comment">// 路由响应式 当current变化时，实现重新render渲染，来实现router-view</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
     data<span class="token operator">:</span> <span class="token punctuation">{</span>
       current<span class="token operator">:</span> <span class="token string">&quot;/&quot;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//监听url变化</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//解析路由配置</span>
 <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 实现两个组件</span>
<span class="token punctuation">}</span>

<span class="token function">bindEvents</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 页面加载完成时触发 load在页面加载或图片加载时触发</span>
   window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onHashChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">// 路由的#/后发生变化时也触发</span>
   window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;hashchange&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">onHashChange</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token function">onHashChange</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 存放地址</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>current <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>hash<span class="token punctuation">.</span><span class="token function">slice</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token string">&quot;/&quot;</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token function">createRouteMap</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// 产生映射关系</span>
   options<span class="token punctuation">.</span>routes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">item</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
     <span class="token keyword">this</span><span class="token punctuation">.</span>routeMap<span class="token punctuation">[</span>item<span class="token punctuation">.</span>path<span class="token punctuation">]</span> <span class="token operator">=</span> item<span class="token punctuation">.</span>component<span class="token punctuation">;</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
 <span class="token function">initComponent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token comment">// router-link,router-view</span>
   <span class="token comment">// &lt;router-link to=&quot;&quot;&gt;fff&lt;/router-link&gt;</span>
   Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&quot;router-link&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
     props<span class="token operator">:</span> <span class="token punctuation">{</span> to<span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span>
     <span class="token comment">// 这里直接写render而不写template，因为是源码，没有编译器，没办法把template再编译成render</span>
     <span class="token function">render</span><span class="token punctuation">(</span><span class="token parameter">h</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
       <span class="token comment">// h(tag, data, children) 实际把router-link渲染成a标签,地址格式为如：#/list</span>
       <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> attrs<span class="token operator">:</span> <span class="token punctuation">{</span> href<span class="token operator">:</span> <span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> <span class="token keyword">this</span><span class="token punctuation">.</span>to <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
         <span class="token comment">// 用插槽来渲染router-link标签内的children内容</span>
         <span class="token keyword">this</span><span class="token punctuation">.</span>$slots<span class="token punctuation">.</span>default
       <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token comment">// &lt;router-view&gt;&lt;/router-view&gt;</span>
   Vue<span class="token punctuation">.</span><span class="token function">component</span><span class="token punctuation">(</span><span class="token string">&quot;router-view&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
     <span class="token comment">// 用箭头函数保留thie指向</span>
     <span class="token function-variable function">render</span><span class="token operator">:</span> <span class="token parameter">h</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
       <span class="token comment">// 拿出component</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>routeMap<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>current<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
       <span class="token keyword">const</span> comp <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>routeMap<span class="token punctuation">[</span><span class="token keyword">this</span><span class="token punctuation">.</span>app<span class="token punctuation">.</span>current<span class="token punctuation">]</span><span class="token punctuation">;</span>
       <span class="token keyword">return</span> <span class="token function">h</span><span class="token punctuation">(</span>comp<span class="token punctuation">)</span><span class="token punctuation">;</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
 <span class="token punctuation">}</span>
 VueRouter<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">Vue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token comment">// 混入  即定义的功能会混入每一个组件的生命周期里</span>
 Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
   <span class="token function">beforeCreate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
     <span class="token comment">// this是Vue实例 main.js里的new Vue  vm.$options:获取Vue实例的自定义属性</span>
     <span class="token comment">// 查看当前Vue实例中有没有挂载router，即查看入口文件main.js中的new Vue ({})中有没有挂载router</span>
     <span class="token comment">// 这个router是router文件夹下的index.js const router = new VueRouter({routes}) ，再导出给main.js的</span>

     <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span><span class="token punctuation">{</span>
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">)</span>
       <span class="token comment">// 仅在根组件执行一次</span>
        <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$router <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router
       console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$router<span class="token punctuation">)</span><span class="token comment">//和this.$options.router等价</span>
       <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>router<span class="token punctuation">.</span><span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
     <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
 <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <h2 id="_15-vue中h、-c、-v、-s的含义"><a href="#_15-vue中h、-c、-v、-s的含义" class="header-anchor">#</a> 15.vue中h、_c、_v、_s的含义</h2> <ul><li>render : h=&gt;h(App)是 render: function(createElement){
return createElement(App)
}的简写</li> <li>元素节点使用createElement创建，别名_c</li> <li>本文节点使用createTextVNode创建，别名_v</li> <li>表达式先使用toString格式化，别名_s</li></ul> <h2 id="_16-vue-和-react-的编译区别"><a href="#_16-vue-和-react-的编译区别" class="header-anchor">#</a> 16.vue 和 react 的编译区别</h2> <ul><li>react：webpack 直接把 jsx 语法转换成 React.createElement</li> <li>vue：
分为三个阶段：
1.parse 解析：解析器将模板解析为抽象语法树 AST，只有将模板解析成 AST 后，才能基于它做优化或生成代码字符串</li></ul> <p>解析器内部分了 HTML 解析器、文本解析器和过滤器解析器，</p> <div class="language-html extra-class"><pre class="language-html"><code>//解析前
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>demo<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>132<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>
    1341
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>

//解析后 root{ type:1, tag:'div', attrs:[{}], attrsMap:{id:'demo'}, children:[
{type:1,tag:'h1',attrsList:Array(0),attrsMap:{...}}, {type:3,tag:' ',
start:37,end:42}, {type:1,tag:'p',attrsList:Array(0),attrsMap:{...}}, ] }
</code></pre></div><p>2.optimize 优化：优化器的作用是在 AST 中找出静态子树并打上标记。静态子树是在 AST 中永远不变的节点，如纯文本节点</p> <p>好处：</p> <ul><li><p>每次重新渲染，不需要为静态节点创建新节点</p></li> <li><p>patch 时跳过静态节点</p> <p>3.generate 代码生成：将 AST 转化为渲染函数 render function 中的内容，即代码字符串</p></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span>
  <span class="token parameter">ast<span class="token operator">:</span>ASTElement <span class="token operator">|</span> <span class="token keyword">void</span><span class="token punctuation">,</span>
  options<span class="token operator">:</span> CompilerOptions</span>
 <span class="token punctuation">)</span><span class="token operator">:</span>CodegenResult <span class="token punctuation">{</span>
    <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CodegenState</span><span class="token punctuation">(</span>options<span class="token punctuation">)</span>
    <span class="token comment">//有就渲染，没有就渲染一个空div</span>
    <span class="token keyword">const</span> code<span class="token operator">=</span>ast<span class="token operator">?</span><span class="token function">genElement</span><span class="token punctuation">(</span>ast<span class="token punctuation">,</span>state<span class="token punctuation">)</span><span class="token operator">:</span><span class="token string">'_c('</span>div<span class="token string">')'</span>
    <span class="token keyword">return</span><span class="token punctuation">{</span>
      <span class="token comment">//调用render函数</span>
      render<span class="token operator">:</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">with(this){return</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>code<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">}</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      staticRenderFns<span class="token operator">:</span>state<span class="token punctuation">.</span>staticRenderFns<span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token comment">//调用结果</span>
<span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'div'</span><span class="token punctuation">,</span><span class="token punctuation">{</span>attrs<span class="token operator">:</span><span class="token punctuation">{</span><span class="token string">&quot;id&quot;</span><span class="token operator">:</span><span class="token string">&quot;demo&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'h1'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;Vue.js测试&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function">_c</span><span class="token punctuation">(</span><span class="token string">'p'</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token function">_v</span><span class="token punctuation">(</span><span class="token function">_s</span><span class="token punctuation">(</span>foo<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>&quot;
</code></pre></div><h2 id="_17-vue-组件之前传值"><a href="#_17-vue-组件之前传值" class="header-anchor">#</a> 17.vue 组件之前传值</h2> <p>vue 和 react 都是单向数据流，即一般来说只能父组件向子组件传递参数和函数，而子组件不能修改接收到的参数</p> <h3 id="父向子"><a href="#父向子" class="header-anchor">#</a> 父向子</h3> <p>父组件以属性形式绑定到子组件，子组件通过 props 接收，props 是一个数组</p> <h3 id="子向父"><a href="#子向父" class="header-anchor">#</a> 子向父</h3> <p>子组件通过$emit(事件，参数)触发父组件的事件并传递参数,父组件通过@emit 中的事件来监听
(在 react 中，父组件通过属性绑定把函数传递给子组件，子组件通过调用 this.props.父组件传递来的函数(参数),就可以传递给父组件参数)</p> <h3 id="兄弟之间的传递"><a href="#兄弟之间的传递" class="header-anchor">#</a> 兄弟之间的传递</h3> <ul><li><strong>依靠事件总线 Event Bus</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// eventbus.js</span>
<span class="token keyword">var</span> bus <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">export</span> <span class="token keyword">default</span> bus

<span class="token comment">// 事件发送方</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">'./eventbus.js'</span>

<span class="token operator">...</span><span class="token punctuation">.</span>

methods<span class="token operator">:</span><span class="token punctuation">{</span>
  <span class="token function-variable function">handle</span><span class="token operator">:</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    bus<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 事件接收方</span>
<span class="token keyword">import</span> bus <span class="token keyword">from</span> <span class="token string">'./eventbus.js'</span>
<span class="token operator">...</span>
<span class="token function">mounted</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  bus<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'events'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">val</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>num<span class="token operator">+=</span><span class="token number">2</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>vuex (适用于复杂的应用，并且符合 Flux 的思想)</strong></li></ul> <h3 id="祖先向后代"><a href="#祖先向后代" class="header-anchor">#</a> 祖先向后代</h3> <ul><li><strong>provide 与 inject(在 react 中是 provide 和 context)</strong>
注意：这两个 api 只能实现祖先向后代的单向传递，后代不能向祖先传递
祖先：</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">provide</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
 <span class="token keyword">return</span> <span class="token punctuation">{</span>foo<span class="token operator">:</span><span class="token string">'foo'</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

后代
inject<span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">'foo'</span><span class="token punctuation">]</span>
</code></pre></div><ul><li><strong>vuex</strong></li></ul> <h3 id="后代向祖先"><a href="#后代向祖先" class="header-anchor">#</a> 后代向祖先</h3> <ul><li><strong>利用递归定义一个 dispatch 派发函数</strong></li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">Event<span class="token punctuation">,</span> data</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> parent <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$parent
  <span class="token keyword">while</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parent<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      parent<span class="token punctuation">.</span><span class="token function">$emit</span><span class="token punctuation">(</span>Event<span class="token punctuation">,</span> data<span class="token punctuation">)</span>
      parent <span class="token operator">=</span> parent<span class="token punctuation">.</span>$parent
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">break</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><strong>vuex</strong></li></ul> <h2 id="_18-实现一个-vuex"><a href="#_18-实现一个-vuex" class="header-anchor">#</a> 18.实现一个 vuex</h2> <ol><li>首先 vuex 也是一个插件，需要 install(类似于实现 vueRouter 中 Vue.use(VueRouter)也是调用了 install)，所以要实现一个 install 方法</li> <li>vuex 中的 Store 维护 state、action、mutations、getter</li></ol> <ul><li>state 是一个对象</li> <li>action({state,commit,dispatch,getters,..},args)</li> <li>mutations(state,args)</li> <li>getter(state)</li></ul> <ol start="3"><li>实现数据响应式需要把 state 挂载到 Vue 的 data 上</li></ol> <div class="language-js extra-class"><pre class="language-js"><code>funciton <span class="token function">install</span><span class="token punctuation">(</span><span class="token parameter">_vue</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  Vue <span class="token operator">=</span> _vue
  Vue<span class="token punctuation">.</span><span class="token function">mixins</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>$store <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$options<span class="token punctuation">.</span>store
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">class</span> <span class="token class-name">Store</span><span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Vue</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      data<span class="token operator">:</span> options<span class="token punctuation">.</span>state
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mutations <span class="token operator">=</span> options<span class="token punctuation">.</span>mutations <span class="token operator">||</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>actions <span class="token operator">=</span> options<span class="token punctuation">.</span>actions
    options<span class="token punctuation">.</span>getters <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">handleGetters</span><span class="token punctuation">(</span>options<span class="token punctuation">.</span>getters<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">commit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>mutations<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">,</span> args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">dispatch</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">type<span class="token punctuation">,</span>args</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>actions<span class="token punctuation">[</span>type<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token punctuation">{</span>commit<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>commit<span class="token punctuation">,</span> state<span class="token operator">:</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">}</span><span class="token punctuation">,</span>args<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token function">handleGetters</span><span class="token punctuation">(</span><span class="token parameter">getters</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// 为Store定义getters</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>getters <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>getters<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token parameter">key</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      Object<span class="token punctuation">.</span><span class="token function">defineProperty</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>getters，key<span class="token punctuation">,</span><span class="token punctuation">{</span>
        <span class="token function-variable function">get</span><span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token keyword">return</span> getters<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div> <div class="gitalk-container"><div id="gitalk-container"></div></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/test/safety.html" class="prev">
        网络安全
      </a></span> <span class="next"><a href="/test/aboutReact.html">
        React 相关
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.b7abec6d.js" defer></script><script src="/assets/js/2.abe78d93.js" defer></script><script src="/assets/js/20.f61f8be2.js" defer></script><script src="/assets/js/5.f990928a.js" defer></script>
  </body>
</html>
